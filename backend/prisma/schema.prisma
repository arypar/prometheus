generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum MarketType {
  CURVE
  DEX
}

enum TransactionType {
  BUY
  SELL
}

enum BotActionType {
  SCAN
  EVALUATE
  BUY
  SELL
  SKIP
  ERROR
  THINK
}

model Token {
  address      String   @id
  name         String
  symbol       String
  description  String?
  imageUrl     String?
  creatorAddress String?
  currentPrice String   @default("0")
  marketCap    String   @default("0")
  volume24h    String   @default("0")
  holderCount  Int      @default(0)
  marketType   MarketType @default(CURVE)
  isListing    Boolean  @default(false)
  score        Float?
  discoveredAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  holding        Holding?
  transactions   Transaction[]
  priceSnapshots PriceSnapshot[]
  botActions     BotAction[]

  @@index([discoveredAt])
  @@index([marketType])
}

model Holding {
  id             String   @id @default(cuid())
  tokenAddress   String   @unique
  amount         String
  avgBuyPrice    String
  totalInvested  String
  realizedPnl    String   @default("0")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  token Token @relation(fields: [tokenAddress], references: [address])

  @@index([tokenAddress])
}

model Transaction {
  id           String          @id @default(cuid())
  txHash       String          @unique
  tokenAddress String
  type         TransactionType
  monAmount    String
  tokenAmount  String
  price        String
  gasCost      String          @default("0")
  timestamp    DateTime        @default(now())

  token Token @relation(fields: [tokenAddress], references: [address])

  @@index([tokenAddress])
  @@index([timestamp])
  @@index([type])
}

model PortfolioSnapshot {
  id             String   @id @default(cuid())
  totalValueMon  String
  unrealizedPnl  String
  realizedPnl    String
  totalGasSpent  String
  holdingsCount  Int
  timestamp      DateTime @default(now())

  @@index([timestamp])
}

model PriceSnapshot {
  id           String   @id @default(cuid())
  tokenAddress String
  price        String
  marketCap    String
  volume       String   @default("0")
  timestamp    DateTime @default(now())

  token Token @relation(fields: [tokenAddress], references: [address])

  @@index([tokenAddress, timestamp])
}

model BotAction {
  id           String        @id @default(cuid())
  action       BotActionType
  tokenAddress String?
  details      Json?
  txHash       String?
  reasoning    String?
  sentiment    String?
  confidence   Float?
  phase        String?
  timestamp    DateTime      @default(now())

  token Token? @relation(fields: [tokenAddress], references: [address])

  @@index([action])
  @@index([timestamp])
  @@index([tokenAddress])
  @@index([sentiment])
}
